{
  "name": "apollo-cassandra",
  "version": "1.0.5",
  "description": "A basic ORM for Cassandra",
  "main": "index.js",
  "scripts": {
    "test": "grunt test"
  },
  "config": {
    "blanket": {
      "pattern": [
        "libs"
      ]
    }
  },
  "repository": {
    "type": "git",
    "url": "git://github.com/3logic/apollo-cassandra.git"
  },
  "dependencies": {
    "async": "^0.9.0",
    "cassandra-driver": "^2.0.0",
    "check-types": "^1.4.0",
    "lodash": "^2.4.1"
  },
  "devDependencies": {
    "chai": "^1.9.1",
    "grunt": "^0.4.5",
    "grunt-contrib-jshint": "^0.10.0",
    "grunt-jsdoc": "^0.5.6",
    "grunt-mocha-cov": "^0.3.0",
    "mocha": "^1.21.3"
  },
  "keywords": [
    "cassandra",
    "orm",
    "model",
    "db",
    "node",
    "javascript",
    "js"
  ],
  "author": {
    "name": "3logic"
  },
  "license": "LGPL-3.0",
  "bugs": {
    "url": "https://github.com/3logic/apollo-cassandra/issues"
  },
  "homepage": "https://github.com/3logic/apollo-cassandra",
  "publishConfig": {
    "registry": "http://registry.npmjs.org/"
  },
  "readme": "Apollo\n======\n\n[![Build Status](https://travis-ci.org/3logic/apollo-cassandra.svg?branch=master)](https://travis-ci.org/3logic/apollo-cassandra)\n[![Coverage Status](https://coveralls.io/repos/3logic/apollo/badge.png?branch=master)](https://coveralls.io/r/3logic/apollo?branch=master)\n\n\nApollo is a <a href=\"http://cassandra.apache.org/\" target=\"_blank\">Cassandra</a> object modeling for <a href=\"http://nodejs.org/\" target=\"_blank\">node.js</a>\n\n## Notes\n\n*Apollo is in early develeopment stage. Code and documentation are incomplete!*\n\n\n## Installation\n\n`npm install --save apollo-cassandra`\n\n## Usage\n\nInclude Apollo and start creating your models\n\n```javascript\nvar Apollo = require('apollo-cassandra');\n\nvar connection = {\n    \"hosts\": [\n        \"127.0.0.1\"\n    ],\n    \"keyspace\": \"my_keyspace\"\n};\n\nvar apollo = new Apollo(connection);\napollo.connect(function(err){\n    if(err) throw err;\n    /* do amazing things! */\n})\n```\n\n### Connection\n\n`Apollo` constructor takes two arguments: `connection` and `options`. Let's see what they are in depth:\n\n- `connection` are a set of options for your connection and accept the following parameters:\n    \n    - `hosts` is an array of string written in the form `host:port` or simply `host` assuming that the default port is 9042\n    - `keyspace` is the keyspace you want to use. If it doesn't exist apollo will create it for you\n    - `username` and `password` are used for authentication\n    - Any other parameter is defined in [api](#api)\n\n- `options` are a set of generic options. Accept the following parameters:\n    \n    - `replication_strategy` can be an object or a string representing <a href=\"http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureDataDistributeReplication_c.html\" target=\"_blank\">cassandra replication strategy</a>. Default is `{'class' : 'SimpleStrategy', 'replication_factor' : 1 }`\n\nHere is a complete example: \n\n```javascript\nvar apollo = new Apollo(\n    {\n       hosts: ['1.2.3.4', '12.3.6.5', 'cassandra.me.com:1212'],\n       keyspace: 'mykeyspace',\n       username: 'username',\n       password: 'password'\n    },\n    {\n        replication_strategy: {'class' : 'NetworkTopologyStrategy', 'dc1': 2 }\n    }\n);\n```\n\n## Schema\n\nNow that apollo is connected, create a `model` describing it through a `schema`\n\n```javascript\nvar personSchema = {\n    { \n        fields:{\n            name    : \"text\",\n            surname : \"text\",\n            age     : \"int\"\n        }, \n        key:[\"name\"] \n    }\n};\n```\n\nNow create a new Model based on your schema. The function `add_model` uses the `table name` and `schema` as parameters.\n\n```javascript\nvar Person = apollo.add_model('person',personSchema);\n```\n\nFrom your model you can query cassandra or save your instances\n\n```javascript\n/*Quesry your db*/\nPerson.find({name: 'jhon'}, function(err, people){\n    if(err) throw err;\n    console.log('Found ', people);\n});\n\n/*Save your instances*/\nvar alex = new Person({name: \"Alex\", surname: \"Rubiks\", age: 32});\nalex.save(function(err){\n    if(!err)\n        console.log('Yuppiie!');\n});\n```\n\n\n## Schema in detail\n\nA schema can be a complex object. Take a look at this example\n\n```javascript\npersonSchema = {\n    \"fields\": {\n        \"id\"     : { \"type\": \"uuid\", \"default\": {\"$db_function\": \"uuid()\"} },\n        \"name\"   : { \"type\": \"varchar\", \"default\": \"no name provided\"},\n        \"surname\"   : { \"type\": \"varchar\", \"default\": \"no surname provided\"},\n        \"complete_name\" : { \"type\": \"varchar\", \"default\": function(){ return this.name + ' ' + this.surname;}},\n        \"age\"    :  { \"type\": \"int\" },\n        \"created\"     : {\"type\": \"timestamp\", \"default\" : {\"$db_function\": \"now()\"} }\n    },\n    \"key\" : [[\"id\"],\"created\"],\n    \"indexes\": [\"name\"]\n}\n```\n\nWhat does the above code means?\n- `fields` are the columns of your table. For each column name the value can be a string representing the type or an object containing more specific informations. i.e.\n    + ` \"id\"     : { \"type\": \"uuid\", \"default\": {\"$db_function\": \"uuid()\"} },` in this example id type is `uuid` and the default value is a cassandra function (so it will be executed from the database). \n    + `\"name\"   : { \"type\": \"varchar\", \"default\": \"no name provided\"},` in this case name is a varchar and, if no value will be provided, it will have a default value of `no name provided`. The same goes for `surname`.\n    + `complete_name` the default values is calculated from others field. When apollo processes you model instances, the `complete_name` will be the result of the function you defined. In the function `this` is bound to the current model instance.\n    + `age` no default is provided and we could write it just as `\"age\": \"int\"`.\n    + `created`, like uuid(), will be evaluated from cassandra using the `now()` function.\n- `key`: here is where you define the key of your table. As you can imagine, the first value of the array is the `partition key` and the others are the `clustering keys`. The `partition key` can be an array defining a `compound key`. Read more about keys on the <a href=\"http://www.datastax.com/documentation/cql/3.1/cql/cql_using/use_compound_keys_t.html\" target=\"_blank\">documentation</a>\n- `indexes` are the index of your table. It's always an array of field names. You can read more on the <a href=\"http://www.datastax.com/documentation/cql/3.1/cql/ddl/ddl_primary_index_c.html\" target=\"_blank\">documentation</a>\n\n## Generating your model\n\nA model is an object representing your cassandra `table`. Your application interact with cassandra through your models. An instance of the model represents a `row` of your table.\n\nLet's create our first model\n```javascript\nvar Person = apollo.add_model('person',personSchema);\n```\n\nnow instantiate a person\n```javascript\nvar john = new Person({name: \"John\", surname: \"Doe\"});\n```\n\nWhen you instantiate a model, every field you defined in schema is automatically a property of your instances. So, you can write:\n\n```javascript\njohn.age = 25;\nconsole.log(john.name); //John\nconsole.log(john.complete_name); // undefined.\n```\n__note__: `john.complete_name` is undefined in the newly created instance but will be populated when the instance is saved because it has a default value in schema definition\n\nJohn is a well defined person but he is not still persisted on cassandra. To persist it we need to save it. So simply:\n\n```javascript\njohn.save(function(err){\n    if(err)\n        return 'Houston we have a problem';\n    else\n        return 'all ok, saved :)';\n\n});\n```\n\nWhen you save an instance all internal validators will check you provided correct values and finally will try to save the instance on cassandra.\n\nOk, we are done with John, let's delete it:\n\n```javascript\njohn.delete(function(err){\n    //...\n});\n```\n\nok, goodbye John.\n\n### A few handy tools for your model\n\nApollo instances provide some utility methods. To generate uuids e.g. in field defaults:\n\n*   `apollo.uuid()`  \n    returns a type 3 (random) uuid, suitable for Cassandra `uuid` fields, as a string\n*   `apollo.timeuuid()`  \n    returns a type 1 (time-based) uuid, suitable for Cassandra `timeuuid` fields, as a string\n\n## Virtual fields\n\nYour model could have some fields which are not saved on database. You can define them as `virtual`\n\n```javascript\npersonSchema = {\n    \"fields\": {\n        \"id\"     : { \"type\": \"uuid\", \"default\": {\"$db_function\": \"uuid()\"} },\n        \"name\"   : { \"type\": \"varchar\", \"default\": \"no name provided\"},\n        \"surname\"   : { \"type\": \"varchar\", \"default\": \"no surname provided\"},\n        \"complete_name\" : {\n            \"type\": \"varchar\",\n            \"virtual\" : {\n                get: function(){return this.name + ' ' +this.surname;},\n                set: function(value){\n                    value = value.split(' ');\n                    this.name = value[0];\n                    this.surname = value[1];\n                }\n            }\n        }\n    }\n}\n```\n\nA virtual field is simply defined adding a `virtual` key in field description. Virtuals can have a `get` and a `set` function, both optional (you should define at least one of them!).\n`this` inside get and set functions is bound to current instance of your model.\n\n## Validators\n\nEvery time you set a property for an instance of your model, an internal type validator checks that the value is valid. If not an error is thrown. But how to add a custom validator? You need to provide your custom validator in the schema definition. For example, if you want to check age to be a number greater than zero:\n\n```javascript\nvar personSchema = {\n    //... other properties hidden for clarity\n    age: {\n        type : \"int\",\n        rule : function(value){ return value > 0; }\n    }\n}\n```\n\nyour validator must return a boolean. If someone will try to assign `john.age = -15;` an error will be thrown.\nYou can also provide a message for validation error in this way\n\n```javascript\nvar personSchema = {\n    //... other properties hidden for clarity\n    age: {\n        type : \"int\",\n        rule : {\n            validator : function(value){ return value > 0; },\n            message   : 'Age must be greater than 0'\n        }\n    }\n}\n```\n\nthen the error will have your message. Message can also be a function; in that case it must return a string:\n\n```javascript\nvar personSchema = {\n    //... other properties hidden for clarity\n    age: {\n        type : \"int\",\n        rule : {\n            validator : function(value){ return value > 0; },\n            message   : function(value){ return 'Age must be greater than 0. You provided '+ value; }\n        }\n    }\n}\n```\n\nThe error message will be `Age must be greater than 0. You provided -15`\n\nNote that default values _are_ validated if defined either by value or as a javascript function. Defaults defined as DB functions, on the other hand, are never validated in the model as they are retrieved _after_ the corresponding data has entered the DB.\nIf you need to exclude defaults from being checked you can pass an extra flag:\n\n```javascript\nvar blogUserSchema = {\n    //... other properties hidden for clarity\n    email: {\n        type : \"text\",\n        default : \"<enter your email here>\",\n        rule : {\n            validator : function(value){ /* code to check that value matches an email pattern*/ },\n            ignore_default: true\n        }\n    }\n}\n```\n\n## Querying your data\n\nOk, now you have a bunch of people on db. How do I retrieve them?\n\n### Find\n\n```javascript\nPerson.find({name: 'John'}, function(err, people){\n    if(err) throw err;\n    console.log('Found ', people);\n});\n```\n\nIn the above example it will perform the query `SELECT * FROM person WHERE name='john'` but `find()` allows you to perform even more complex queries on cassandra.  You should be aware of how to query cassandra. Every error will be reported to you in the `err` argument, while in `people` you'll find instances of `Person`. If you don't want apollo to cast results to instances of your model you can use the `raw` option as in the following example:\n\n```javascript\nPerson.find({name: 'John'}, { raw: true }, function(err, people){\n    //people is an array of plain objects\n});\n```\n\nLet's see a complex query\n\n```javascript\nvar query = {\n    name: 'John', // stays for name='john' \n    age : { '$gt':10 }, // stays for age>10 You can also use $gte, $lt, $lte\n    surname : { '$in': ['Doe','Smith'] }, //This is an IN clause\n    $orderby:{'$asc' :'age'} }, //Order results by age in ascending order. Also allowed $desc and complex order like $orderby:{'$asc' : ['k1','k2'] } }\n    $limit: 10 //limit result set\n\n}\n```\n\nNote that all query clauses must be Cassandra compliant. You cannot, for example, use $in operator for a key which is not the partition key. Querying in Cassandra is very basic but could be confusing at first. Take a look at this <a href=\"http://mechanics.flite.com/blog/2013/11/05/breaking-down-the-cql-where-clause/\" target=\"_blank\">post</a> and, obvsiouly, at the <a href=\"http://www.datastax.com/documentation/cql/3.1/cql/cql_using/about_cql_c.html\" target=\"_blank\">documentation</a>\n\n\n## API\n\nComplete API definition is available on the <a href=\"http://apollo.3logic.it\" target=\"_blank\">3logic website</a>.\nAnyway, you can generate the documentation by cloning this project and launching `grunt doc`\n\n## Test\n\nTo test Apollo create a file named `local_conf.json` in `test` directory with your connection configuration as below\n\n```json\n{\n    \"contactPoints\": [\n       \"127.0.0.1\",\n       \"192.168.100.65\",\n       \"my.cassandra.com:9845\"\n    ],\n    \"keyspace\": \"tests\"\n}\n```\n\n## About\n\nApollo is brought to you by\n\n- [Niccol√≤ Biondi](https://github.com/bionicco)\n- [Elia Cogodi](https://github.com/ecogodi)\n- [Fabrizio Ruggeri](https://github.com/ramiel)\n\nThanks to _Gianni Cossu_ and [Massimiliano Atzori](https://github.com/amaxis) for helping.\n\nThanks to [3logic](http://www.3logic.it) too!\n",
  "readmeFilename": "README.md",
  "_id": "apollo-cassandra@1.0.5",
  "dist": {
    "shasum": "77729cf62dac1994fa995dddf521476356c5d767"
  },
  "_from": "apollo-cassandra@",
  "_resolved": "https://registry.npmjs.org/apollo-cassandra/-/apollo-cassandra-1.0.5.tgz"
}
